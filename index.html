<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEL å¿ƒæƒ…åµæ¢å¯¦é©—å®¤</title>
  
  <script src="config.js"></script>

  <style>
    body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 350px; text-align: center; }
    h2 { color: #333; margin-bottom: 25px; }
    .input-group { margin-bottom: 15px; text-align: left; }
    label { font-size: 12px; color: #666; font-weight: bold; margin-left: 5px;}
    input { width: 100%; padding: 12px; margin-top: 5px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    .btn-primary { width: 100%; padding: 14px; margin-top: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
    .btn-go { background-color: #34A853; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block; margin-top: 10px; }
    
    /* åˆ‡æ›é€£çµæ¨£å¼ */
    .toggle-link { margin-top: 20px; font-size: 14px; color: #5f6368; cursor: pointer; text-decoration: underline; }
    .hidden { display: none; }
    
    #msg { margin-top: 15px; font-size: 14px; min-height: 20px; }
    .admin-area { margin-top: 30px; padding-top: 15px; border-top: 1px dashed #eee; }
    .admin-trigger { font-size: 12px; color: #aaa; cursor: pointer; border: 1px solid #eee; padding: 5px 10px; border-radius: 20px; display:inline-block;}
    #adminRealLink { display: none; background-color: #e55039; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="formTitle">ğŸ•µï¸â€â™‚ï¸ åµæ¢ç™»å…¥</h2>
    
    <form id="authForm">
      <div class="input-group"><label>å¸³è™Ÿ</label><input type="text" id="account" required></div>
      <div class="input-group"><label>å¯†ç¢¼</label><input type="password" id="password" required></div>
      
      <div id="nameGroup" class="input-group hidden"><label>å§“å (ä½ çš„ä»£è™Ÿ)</label><input type="text" id="name"></div>
      
      <button type="button" id="submitBtn" class="btn-primary" onclick="handleSubmit()">é€²å…¥ç³»çµ±</button>
    </form>
    
    <div id="msg"></div>
    
    <div class="toggle-link" onclick="toggleMode()">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿé»æ­¤è¨»å†Š</div>

    <div class="admin-area">
      <div id="adminTrigger" class="admin-trigger" onclick="unlockAdmin()">ğŸ”§ æ•™å¸«å°ˆç”¨é€šé“</div>
      <a id="adminRealLink" href="#" target="_top">ğŸš€ é»æ­¤é€²å…¥å¾Œå°</a>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = "123";
    let isRegisterMode = false; // ç‹€æ…‹è®Šæ•¸

    // API é€£ç·šå·¥å…·
    function callApi(action, payload = {}) {
        if(typeof CONFIG === 'undefined' || !CONFIG.API_ENDPOINT || CONFIG.API_ENDPOINT.includes("YOUR_SCRIPT_URL")) {
            alert("âš ï¸ è¨­å®šéŒ¯èª¤ï¼šè«‹æª¢æŸ¥ config.jsï¼Œç¢ºèªç¶²å€å·²è¨­å®šï¼"); 
            return Promise.reject("Config Error");
        }
        const data = { action: action, ...payload };
        return fetch(CONFIG.API_ENDPOINT, { method: "POST", body: JSON.stringify(data) }).then(res => res.json());
    }

    // --- åˆ‡æ› ç™»å…¥/è¨»å†Š æ¨¡å¼ ---
    function toggleMode() {
      isRegisterMode = !isRegisterMode;
      document.getElementById('msg').innerHTML = "";
      document.getElementById('authForm').reset();
      
      if (isRegisterMode) {
        document.getElementById('formTitle').innerText = "ğŸ“ æ–°åµæ¢å ±åˆ°";
        document.getElementById('nameGroup').classList.remove('hidden');
        document.getElementById('submitBtn').innerText = "ç¢ºèªè¨»å†Š";
        document.querySelector('.toggle-link').innerText = "å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥";
      } else {
        document.getElementById('formTitle').innerText = "ğŸ•µï¸â€â™‚ï¸ åµæ¢ç™»å…¥";
        document.getElementById('nameGroup').classList.add('hidden');
        document.getElementById('submitBtn').innerText = "é€²å…¥ç³»çµ±";
        document.querySelector('.toggle-link').innerText = "é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿé»æ­¤è¨»å†Š";
      }
    }

    // --- é€å‡ºè¡¨å–® (ç™»å…¥æˆ–è¨»å†Š) ---
    function handleSubmit() {
      const acc = document.getElementById('account').value;
      const pwd = document.getElementById('password').value;
      const name = document.getElementById('name').value;
      const btn = document.getElementById('submitBtn');
      const msg = document.getElementById('msg');

      if (!acc || !pwd) { alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™"); return; }
      if (isRegisterMode && !name) { alert("è¨»å†Šæ™‚è«‹è¼¸å…¥å§“å"); return; }
      
      btn.disabled = true;
      btn.innerText = "è™•ç†ä¸­...";
      msg.innerHTML = "";

      if (isRegisterMode) {
        // --- è¨»å†Šæµç¨‹ ---
        callApi('register', { account: acc, password: pwd, name: name })
          .then(res => {
             if (res.status === 'success') {
               alert(res.message);
               toggleMode(); // è¨»å†ŠæˆåŠŸå¾Œï¼Œè‡ªå‹•åˆ‡æ›å›ç™»å…¥æ¨¡å¼
             } else {
               alert(res.message);
             }
             btn.disabled = false;
             btn.innerText = "ç¢ºèªè¨»å†Š";
          });
      } else {
        // --- ç™»å…¥æµç¨‹ ---
        callApi('login', { account: acc, password: pwd })
          .then(res => {
             if (res.status === 'success') {
               msg.style.color = "green";
               localStorage.setItem('studentName', res.name);
               // æˆåŠŸå¾Œè·³è½‰åˆ°éŠæˆ²é 
               msg.innerHTML = `âœ… ç™»å…¥æˆåŠŸï¼<br><a href="game.html" class="btn-go">ğŸ‘‰ é»æ­¤é€²å…¥éŠæˆ²</a>`;
               setTimeout(() => { window.location.href = "game.html"; }, 1000);
             } else {
               alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
               btn.disabled = false;
               btn.innerText = "é€²å…¥ç³»çµ±";
             }
          });
      }
    }

    // æ•™å¸«å¾Œå°è§£é–
    function unlockAdmin() {
      let input = prompt("ğŸ”’ è«‹è¼¸å…¥æ•™å¸«å¯†ç¢¼ï¼š");
      if (input === ADMIN_PASSWORD) {
        // ç›´æ¥è·³è½‰åˆ° GitHub çš„ admin.html
        document.getElementById('adminRealLink').href = "admin.html";
        document.getElementById('adminTrigger').style.display = 'none';
        document.getElementById('adminRealLink').style.display = 'inline-block';
        alert("å¯†ç¢¼æ­£ç¢ºï¼è«‹é»æ“Šç´…è‰²æŒ‰éˆ•ã€‚");
      } else if (input !== null) {
        alert("âŒ å¯†ç¢¼éŒ¯èª¤");
      }
    }
  </script>
</body>
</html>
