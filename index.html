<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEL å¿ƒæƒ…åµæ¢å¯¦é©—å®¤</title>
  
  <script src="config.js"></script>

  <style>
    body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 350px; text-align: center; }
    h2 { color: #333; margin-bottom: 25px; }
    .input-group { margin-bottom: 15px; text-align: left; }
    label { font-size: 12px; color: #666; font-weight: bold; margin-left: 5px;}
    input { width: 100%; padding: 12px; margin-top: 5px; border: 2px solid #e1e4e8; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    .btn-primary { width: 100%; padding: 14px; margin-top: 10px; background: #4285F4; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
    .btn-go { background-color: #34A853; color: white; padding: 12px 20px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block; margin-top: 10px; }
    #msg { margin-top: 15px; font-size: 14px; min-height: 20px; }
    
    /* æ•™å¸«æŒ‰éˆ•å€åŸŸ */
    .admin-area { margin-top: 30px; padding-top: 15px; border-top: 1px dashed #eee; }
    .admin-trigger { font-size: 12px; color: #aaa; cursor: pointer; border: 1px solid #eee; padding: 5px 10px; border-radius: 20px; display:inline-block;}
    
    /* ç´…è‰²æŒ‰éˆ• */
    #adminRealLink { display: none; background-color: #e55039; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="formTitle">ğŸ•µï¸â€â™‚ï¸ åµæ¢ç™»å…¥</h2>
    
    <form id="authForm">
      <div class="input-group"><label>å¸³è™Ÿ</label><input type="text" name="account" required></div>
      <div class="input-group"><label>å¯†ç¢¼</label><input type="password" name="password" required></div>
      <button type="button" id="submitBtn" class="btn-primary" onclick="handleSubmit()">é€²å…¥ç³»çµ±</button>
    </form>
    
    <div id="msg"></div>
    <div class="admin-area">
      <div id="adminTrigger" class="admin-trigger" onclick="unlockAdmin()">ğŸ”§ æ•™å¸«å°ˆç”¨é€šé“</div>
      <a id="adminRealLink" href="#" target="_top">ğŸš€ é»æ­¤é€²å…¥å¾Œå°</a>
    </div>
  </div>

  <script>
    const ADMIN_PASSWORD = "123";

    // â–¼â–¼â–¼ é€™è£¡æ”¹ç”¨è®Šæ•¸ï¼Œä¸è¦ç›´æ¥å¯«æ­»ç¶²å€ â–¼â–¼â–¼
    // å¯¦éš›ä¸Šå‚³ GitHub æ™‚ï¼Œç¶²å€æœƒè®€å– config.js (config.sample.js)
    let MY_URL = "";
    if (typeof CONFIG !== 'undefined' && CONFIG.API_ENDPOINT) {
        MY_URL = CONFIG.API_ENDPOINT;
    } else {
        MY_URL = "YOUR_SCRIPT_URL_HERE"; // é è¨­ä½”ä½ç¬¦
    }
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    function unlockAdmin() {
      let input = prompt("ğŸ”’ è«‹è¼¸å…¥æ•™å¸«å¯†ç¢¼ï¼š");
      if (input === ADMIN_PASSWORD) {
        
        // æª¢æŸ¥ä½¿ç”¨è€…æœ‰æ²’æœ‰è¨­å®šç¶²å€
        if (MY_URL === "YOUR_SCRIPT_URL_HERE" || !MY_URL) {
           alert("æé†’ï¼šè«‹å…ˆåœ¨ config.js è¨­å®šæ‚¨çš„ GAS ç¶²å€");
        }

        let targetUrl = MY_URL.includes('?') ? MY_URL + '&page=admin' : MY_URL + '?page=admin';

        let linkBtn = document.getElementById('adminRealLink');
        linkBtn.href = targetUrl;
        
        document.getElementById('adminTrigger').style.display = 'none';
        linkBtn.style.display = 'inline-block';
        
        alert("å¯†ç¢¼æ­£ç¢ºï¼è«‹é»æ“Šç´…è‰²æŒ‰éˆ•ã€‚");
      } else if (input !== null) {
        alert("âŒ å¯†ç¢¼éŒ¯èª¤");
      }
    }

    function handleSubmit() {
      const form = document.getElementById('authForm');
      const msg = document.getElementById('msg');
      if (!form.account.value || !form.password.value) { alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™"); return; }
      
      document.getElementById('submitBtn').innerText = "é©—è­‰ä¸­...";
      
      // â˜… GitHub å±•ç¤ºç”¨é˜²å‘†æ©Ÿåˆ¶ â˜…
      if (typeof google === 'undefined') {
          alert("âš ï¸ æ­¤é é¢ç›®å‰åœ¨ GitHub å±•ç¤ºæ¨¡å¼ï¼Œç„¡æ³•ç›´æ¥é€£ç·š Google è³‡æ–™åº«ã€‚\n\nè«‹å°‡ç¨‹å¼ç¢¼è²¼å› Google Apps Script å°ˆæ¡ˆä¸­åŸ·è¡Œï¼Œæˆ–è¨­å®š fetch API æ¨¡å¼ã€‚");
          document.getElementById('submitBtn').innerText = "é€²å…¥ç³»çµ±";
          return;
      }

      // æ­£å¸¸çš„ GAS ç™»å…¥æµç¨‹
      google.script.run.withSuccessHandler(res => {
           if (res.result === 'success') {
             msg.style.color = "green";
             localStorage.setItem('studentName', res.name);
             
             let gameUrl = MY_URL.includes('?') ? MY_URL + '&page=game' : MY_URL + '?page=game';
             
             msg.innerHTML = `âœ… ç™»å…¥æˆåŠŸï¼<br><a href="${gameUrl}" target="_top" class="btn-go">ğŸ‘‰ é»æ­¤é€²å…¥éŠæˆ²</a>`;
             setTimeout(() => { window.top.location.href = gameUrl; }, 1000);
           } else {
             alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
             document.getElementById('submitBtn').innerText = "é€²å…¥ç³»çµ±";
           }
        }).loginCheck(form);
    }
  </script>
</body>
</html>